{{ define "main" }}

    <article class="entry">
        <header class="entry-header">
            <h2 class="entry-title">{{ .Title }}</h2>
        </header>

        <div class="entry-content">

            <div id="map" class="map" />

                <script>
           
                    // home
                    const center = [49.2202194, 16.5558572]
                    
                    // leaflet map instance
                    var map = L.map("map", { fullscreenControl: true }).setView(center, 12);
                    
                    // tile layer - mapy.cz tourist map
                    L.tileLayer('https://mapserver.mapy.cz/turist-m/{z}-{x}-{y}', {
                        attribution: mapyCzAttr,
                        minZoom: 2,
                        maxZoom: 20,
                        maxNativeZoom: 18,
                        id: 'mapycz',
                        tileSize: 256
                    }).addTo(map);

                    // add markers
                    var markers = L.markerClusterGroup();
                    var marker

                    {{/* loop through all tags */}}
                    {{ range $tagKey, $tagValue := $.Site.Taxonomies.tags }}

                        {{/* look for coordinates - loop through all tag locations */}}
                        {{ range $locTagKey, $locTagValue := $.Site.Data.tag_locations.located }}
                            {{/* if coordinates for tag were found, add marker */}}
                            {{ if (eq $tagValue.Page.Title $locTagKey )}}
                                marker = L.marker([{{- $locTagValue.lat -}}, {{- $locTagValue.lng -}} ]);
                                marker.bindPopup('<div class="bsmap-popup-content"><a href="{{ $tagValue.Page.Permalink }}" title="{{ $tagValue.Page.Title }}">{{ $tagValue.Page.Title }} ({{ $tagValue.Count }})</a></div>');
                                markers.addLayer(marker)
                            {{ end }}
                        {{ end }}
                    {{ end }}

                    map.addLayer(markers);
                    map.fitBounds(markers.getBounds());
                </script>
            </div>
        </div>
    </article>

{{ end }}